name: README Translation Bot (Codex)

on:
  push:
    paths:
      - 'README.md'
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  translate-readme:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
      
      - name: Install OpenAI Codex
        run: |
          npm install -g @openai/codex
        
      - name: Translate README with Codex
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          CODEX_QUIET_MODE: "1"
        run: |
          # READMEã‚’è‹±èªã«ç¿»è¨³ã™ã‚‹ãŸã‚ã«Codexã‚’ä½¿ç”¨
          codex -a auto-edit  --quiet "
          README.mdã‚’è‹±èªã«ç¿»è¨³ã—ã¦ãã ã•ã„ã€‚
          
          ä»¥ä¸‹ã®è¦ä»¶ã«å¾“ã£ã¦ç¿»è¨³ã—ã¦ãã ã•ã„ï¼š
          
          1. å…ƒã®ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã‚’ç¶­æŒ
          2. æŠ€è¡“ç”¨èªã¯é©åˆ‡ãªè‹±èªã§è¡¨ç¾
          3. çµµæ–‡å­—ã¯ãã®ã¾ã¾ç¶­æŒ
          4. ãƒãƒƒã‚¸ã‚„ãƒªãƒ³ã‚¯ã¯å¤‰æ›´ã—ãªã„
          5. ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®å†…å®¹ã¯ç¿»è¨³ã—ãªã„
          
          ç¿»è¨³å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ README.en.md ã¨ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚
          ãã®å¾Œã€ä»¥ä¸‹ã®ä½œæ¥­ã‚’è¡Œã£ã¦ãã ã•ã„ï¼š
          
          1. æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
          2. README.en.md ã‚’ã‚³ãƒŸãƒƒãƒˆ
          3. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ
          4. PRã®èª¬æ˜æ–‡ã«ç¿»è¨³ã®å“è³ªã«é–¢ã™ã‚‹ç°¡å˜ãªã‚µãƒãƒªãƒ¼ã‚’è¨˜è¼‰
          
          é‡è¦: GitHubã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯ç’°å¢ƒå¤‰æ•° GITHUB_TOKEN ã§åˆ©ç”¨å¯èƒ½ã§ã™ã€‚
          "
      
      - name: Create PR if translation is created
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          CODEX_QUIET_MODE: "1"
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          if [ -f "README.en.md" ]; then
            BRANCH_NAME="docs/translate-readme-en-$(date +%Y%m%d-%H%M%S)"
            git checkout -b $BRANCH_NAME
            git add README.en.md
            git commit -m "docs: READMEã‚’è‹±èªã«ç¿»è¨³"
            git push origin $BRANCH_NAME
            
            gh pr create --title "ğŸ“„ docs: READMEã‚’è‹±èªã«ç¿»è¨³" \
                         --body "Codexã«ã‚ˆã£ã¦READMEã‚’è‹±èªã«ç¿»è¨³ã—ã¾ã—ãŸã€‚" \
                         --base develop \
                         --head $BRANCH_NAME
          fi
